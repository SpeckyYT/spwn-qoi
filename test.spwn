extract import "lib.spwn"

file = () => [113,111,105,102,0,0,0,32,0,0,0,32,4,0,254,46,39,62,254,0,0,0,52,53,254,101,88,114,53,192,58,52,192,53,58,193,52,53,52,53,254,181,104,176,254,219,153,137,254,255,230,213,53,3,193,53,192,2,53,52,193,53,58,52,53,58,53,44,53,58,52,192,53,58,193,52,53,52,53,44,53,179,152,195,3,53,44,53,52,192,53,58,53,58,53,192,44,53,192,58,52,53,192,58,193,52,53,44,21,192,3,53,194,21,192,2,44,53,52,53,58,53,58,53,44,53,44,192,53,193,44,53,194,44,21,2,53,198,21,44,53,52,53,58,53,58,53,192,21,195,44,196,21,2,53,193,254,162,129,54,53,254,251,212,54,53,254,254,254,254,254,211,202,220,53,21,44,53,192,58,52,53,21,192,44,53,193,44,21,192,44,2,193,21,3,192,53,36,26,192,53,23,36,192,3,21,193,53,58,192,21,58,53,197,44,21,2,3,21,3,194,36,192,26,23,4,23,36,3,23,21,192,36,53,21,58,52,58,53,194,4,53,192,2,21,3,21,3,194,36,23,192,4,192,23,3,192,23,21,192,3,36,21,58,53,52,58,53,44,26,53,26,36,53,23,21,192,3,195,23,194,53,3,192,23,21,3,36,21,53,58,53,52,58,53,44,53,26,192,4,36,21,193,3,194,23,3,53,193,3,193,23,21,3,192,21,53,58,53,192,58,52,53,44,53,4,192,23,192,21,193,3,192,23,3,197,23,21,3,192,36,21,36,53,184,152,53,58,52,53,44,2,53,192,3,23,21,193,3,23,3,198,23,21,3,2,3,21,36,192,21,192,58,23,52,53,44,2,3,192,23,21,3,192,21,3,197,23,192,21,3,2,192,36,3,21,192,36,53,23,52,192,53,44,2,3,23,21,3,194,21,192,3,192,23,193,21,192,3,192,2,44,3,36,21,36,192,23,58,52,193,53,44,2,23,21,3,196,21,195,3,193,2,44,192,36,3,36,21,23,53,58,52,193,23,193,21,44,2,3,203,2,44,192,36,192,3,36,21,192,23,194,53,21,192,3,53,44,2,3,201,2,44,192,53,36,3,36,193,53,21,195,53,44,2,3,204,2,44,192,53,3,36,3,36,3,36,53,58,52,193,53,44,2,3,203,2,44,192,53,58,36,193,3,36,3,53,58,192,52,192,53,44,2,3,193,53,3,199,44,192,53,58,192,3,36,3,36,193,53,58,192,52,193,53,44,2,3,193,53,192,3,196,44,192,53,58,192,52,36,3,36,3,36,3,53,58,192,52,194,53,2,3,200,44,53,192,58,193,52,3,36,193,3,36,53,58,192,52,195,53,204,58,192,52,192,36,3,36,3,36,3,53,58,193,52,192,53,192,23,204,53,192,52,192,36,192,3,36,193,53,58,193,53,192,23,254,224,194,209,53,204,23,53,52,192,53,3,36,3,36,53,58,192,53,192,23,22,53,192,44,36,203,53,192,52,192,23,53,36,192,3,53,58,53,22,192,53,192,36,44,36,205,53,52,192,23,192,53,3,53,58,53,22,192,53,44,36,44,36,44,36,204,53,52,192,53,23,192,53,58,53,22,192,53,44,36,44,36,44,36,44,36,203,53,52,192,44,53,23,192,53,22,192,53,44,193,36,44,36,44,36,44,36,202,53,52,192,44,192,53,195,44,193,36,44,36,44,36,44,36,44,36,201,53,52,192,44,192,53,254,81,32,78,193,53,44,194,36,44,36,44,36,44,36,44,36,200,53,52,192,0,0,0,0,0,0,0,1]

output = @qoi::decode(file(), true, false) // $.readfile("./qoi_test_images/edgecase.qoi", "bin")

scaling = 0.5

// image_flat = output.image.flatten()

red_color = ?c
// red_color.set(@chroma::rgb8(255,0,0))


for x in 0..output.width {
    for y in 0..output.height {
        color = output.image[x][y] // image_flat[x * output.width + y]

        if color.a == 0 { continue }

        rgba_color = @chroma::rgb8(color.r, color.g, color.b, color.a)
        hue = rgba_color.h360()
        saturation = rgba_color.s()
        value = rgba_color.v()

        $.add(obj {
            OBJ_ID: 211,
            X: x * 30 * scaling + 90,
            Y: (output.height - y - 1) * 30 * scaling + 90,
            SCALING: scaling,
            HVS_ENABLED: true,
            HVS: f"{hue}a{saturation}a{value}a0a0",
            COLOR: red_color,
        })
    }
}
